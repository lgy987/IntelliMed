# 医疗费用支付管理系统

## 项目简介
这是一个基于Qt框架开发的医疗费用支付管理系统，用于管理医院的医疗费用项目、支付状态跟踪、缴费历史查询和电子票据生成等功能。

## 系统架构
- **开发框架**: Qt 5+ C++
- **数据库**: SQLite
- **设计模式**: MVC模式，使用QSqlTableModel管理数据

## 主要功能模块

### 1. 主界面 (MedPay)
- 显示用户基本信息（姓名、年龄、性别、电话、身份证号）
- 显示待支付和已支付的统计信息
- 提供导航到其他功能模块的按钮

### 2. 待支付管理 (Unpaid)
- 显示所有待支付的医疗费用项目
- 支持单个或批量支付操作
- 实时更新支付状态
- 显示待支付项目总数和总金额

### 3. 缴费历史 (PaymentHistory)
- 显示所有已支付的医疗费用记录
- 支持数据导出为CSV格式
- 显示已支付项目总数和总金额
- 按收费时间降序排列

### 4. 电子票据 (E_Invoice)
- 显示所有医疗费用项目（包括待支付和已支付）
- 支持生成电子票据
- 支持票据打印功能
- 支持数据筛选（按支付状态和科室）
- 支持数据下载（CSV格式）
- 显示详细的统计信息

## 数据库结构

### medical_expenses 表
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键，自增 |
| item_name | VARCHAR(100) | 项目名称 |
| unit_price | DECIMAL(10,2) | 单价 |
| quantity | INTEGER | 数量 |
| amount | DECIMAL(10,2) | 总金额 |
| department | VARCHAR(100) | 收费科室 |
| charge_time | DATETIME | 收费时间 |
| payment_method | VARCHAR(50) | 支付方式 |
| payment_status | VARCHAR(50) | 支付状态 |

## 使用方法

### 1. 启动程序
运行编译后的可执行文件，系统会自动连接数据库并创建必要的表结构。

### 2. 支付操作
1. 在主界面点击"待支付"按钮进入待支付管理界面
2. 选择要支付的项目（可单选或多选）
3. 点击"支付选中项目"或"支付所有项目"按钮
4. 确认支付操作

### 3. 查看缴费历史
1. 在主界面点击"缴费历史"按钮
2. 系统会显示所有已支付的记录
3. 可以点击"导出数据"按钮将数据导出为CSV文件

### 4. 生成电子票据
1. 在主界面点击"电子票据"按钮
2. 使用筛选功能选择特定状态或科室的项目
3. 选择要生成票据的项目
4. 点击"生成票据"按钮
5. 可以点击"打印票据"按钮进行打印
6. 可以点击"下载"按钮导出数据为CSV文件

### 5. 数据筛选和导出
1. 在电子票据界面使用状态筛选下拉框选择支付状态
2. 使用科室筛选下拉框选择特定科室
3. 筛选结果会实时显示在表格中
4. 点击"下载"按钮：
   - 如果已生成票据，则下载该票据为TXT文本文件
   - 如果未生成票据，则下载全部数据为CSV文件
5. 导出的文件默认保存在"文档"文件夹中

### 6. 打印功能
1. **电子票据打印**：生成票据后，点击"打印"按钮可打印票据内容
2. **缴费历史打印**：在缴费历史界面点击"打印"按钮可打印完整的缴费历史报表


## 技术特点

### 1. 数据同步机制
- 使用Qt的信号槽机制实现数据变化通知
- 支付完成后自动刷新所有相关界面
- 实时更新统计信息

### 2. 用户界面
- 响应式设计，支持窗口大小调整
- 表格视图显示数据，支持排序和选择
- 统一的返回按钮和刷新按钮

### 3. 数据管理
- 自动创建数据库和表结构
- 支持示例数据的自动插入
- 数据导出功能

### 4. Qt5兼容性
- 所有代码均使用Qt5兼容的语法
- 信号槽连接使用static_cast代替QOverload以确保Qt5兼容性
- 明确指定Qt5版本要求

## 编译和运行

### 环境要求
- Qt 5.9+ (推荐Qt 5.12+)
- C++11 兼容的编译器
- Windows/Linux/macOS


