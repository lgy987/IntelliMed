# 健康自测问卷 - 数据库功能说明

## 新增功能概述

本项目已成功集成数据库功能，患者提交问卷后数据会自动保存到SQLite数据库中。

## 新增文件

### 1. DatabaseManager.h/cpp
- **功能**: 数据库管理类，负责数据库连接、表创建、数据插入和查询
- **数据库类型**: SQLite
- **存储位置**: 用户文档目录下的 `HealthAssess/health_assess.db`

### 2. DataViewer.h/cpp
- **功能**: 数据查看窗口，提供患者数据的查看、搜索和导出功能
- **特性**: 
  - 表格形式显示所有患者数据
  - 支持按姓名、手机号搜索
  - 数据导出为CSV格式
  - 实时刷新数据

## 数据库表结构

### patient_assessments 表
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | INTEGER | 主键，自增 |
| name | TEXT | 患者姓名 |
| age | INTEGER | 年龄 |
| gender | TEXT | 性别 |
| height | REAL | 身高(cm) |
| weight | REAL | 体重(kg) |
| phone | TEXT | 手机号 |
| bmi | REAL | BMI指数 |
| bmi_status | TEXT | BMI状态描述 |
| lifestyle_choices | TEXT | 生活方式选择 |
| health_score | INTEGER | 健康评分 |
| submission_time | DATETIME | 提交时间 |

## 使用方法

### 1. 提交问卷
- 填写问卷信息
- 点击"提交"按钮
- 数据自动保存到数据库
- 表单自动清空，方便继续录入

### 2. 查看数据
- 点击"查看患者数据"按钮
- 打开数据查看窗口
- 可以查看所有患者数据
- 支持搜索和导出功能

### 3. 数据搜索
- 选择搜索字段（姓名/手机号）
- 输入搜索关键词
- 点击"搜索"按钮
- 显示匹配结果

### 4. 数据导出
- 在数据查看窗口中点击"导出数据"
- 选择保存位置和文件名
- 数据以CSV格式导出

## 技术特性

- **SQLite数据库**: 轻量级、无需安装的数据库
- **自动表创建**: 首次运行时自动创建数据表
- **数据验证**: 提交前进行数据完整性验证
- **错误处理**: 完善的错误提示和异常处理
- **内存管理**: 智能指针管理，避免内存泄漏

## 编译要求

- Qt 5.12+ 或 Qt 6.0+
- 启用SQL模块 (`QT += sql`)
- C++11 支持

## 注意事项

1. 数据库文件存储在用户文档目录，确保有写入权限
2. 首次运行会自动创建数据库和表结构
3. 如果数据库连接失败，程序仍可正常运行，但数据无法保存
4. 导出的CSV文件使用UTF-8编码，支持中文显示

## 故障排除

### 数据库连接失败
- 检查用户文档目录权限
- 确认Qt SQL模块已正确安装
- 查看控制台错误信息

### 数据无法保存
- 检查数据库连接状态
- 确认表结构是否正确创建
- 查看控制台调试信息

### 搜索功能异常
- 确认搜索字段选择正确
- 检查搜索关键词格式
- 验证数据库查询语句
